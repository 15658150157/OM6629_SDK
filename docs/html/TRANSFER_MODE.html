<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!-- BEGIN opengraph metadata -->
<meta property="og:title" content="Doxygen Awesome" />
<meta property="og:image" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta property="og:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<meta property="og:url" content="https://jothepro.github.io/doxygen-awesome-css/" />
<!-- END opengraph metadata -->
<!-- BEGIN twitter metadata -->
<meta name="twitter:image:src" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta name="twitter:title" content="Doxygen Awesome" />
<meta name="twitter:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<!-- END twitter metadata -->
<title>User Guide: Transfer Mode</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/svg+xml" href="logo.drawio.svg"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/
<a href="https://github.com/jothepro/doxygen-awesome-css" class="github-corner" title="View source on GitHub" target="_blank">
    <svg viewBox="0 0 250 250" width="40" height="40" style="position: absolute; top: 0; border: 0; right: 0; z-index: 99;" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
-->
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">User Guide
   </div>
   <div id="projectbrief">Bluetooth Low Energy 5.4</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('TRANSFER_MODE.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Transfer Mode </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_doxygen_source_24g_transfer_mode"></a> The protocol supports a receiver to communicate with up to six transmitters simultaneously. But a transmitter can only communicate with one receiver. A data pipe is a logical channel in the physical RF channel. Each data pipe has its own one byte physical address (data pipe address) decoding in the RF transceiver.</p>
<p>The RF transceiver configured as PRX (primary receiver) can receive data addressed to 6 different data pipes in one frequency channel as shown in Figure. Each data pipe has its own unique address and can be configured for individual behavior. Up to 6 RF transceivers configured as PTX can communicate with one RF transceiver configured as PRX. All data pipe addresses are searched for simultaneously. Only one data pipe can receive a packet at a time. All data pipes can perform Protocol engine functionality. <br  />
</p>
<div class="image">
<img src="MultiSlave.png" alt=""/>
<div class="caption">
Multiple slave</div></div>
    <p><b>The following settings are common to all data pipes:</b></p>
<ul>
<li>CRC enabled/disabled (CRC always enabled when ACK mode is enabled)</li>
<li>CRC encoding scheme</li>
<li>Data whitening</li>
<li>RX address width</li>
<li>Fixed payload length</li>
<li>Frequency channel</li>
<li>Air data rate</li>
<li>LNA gain</li>
</ul>
<p>The data pipes are enabled with the bits in the EN_RXADDR register. Each data pipe address is configured in the RX_ADDR_Px (x: 0~5) registers.</p>
<dl class="section note"><dt>Note</dt><dd>Always ensure that none of the data pipes have the same address.</dd></dl>
<p>The PRX, using multiple slave and Protocol engine, receives packets from more than one PTX. To ensure that the ACK packet from the PRX is transmitted to the correct PTX, the PRX takes the data pipe address where it received the packet and uses it as the TX address when transmitting the ACK packet. Figure is an example of an address configuration for the PRX and PTX. On the PRX the RX_ADDR_Px, defined as the pipe address, must be unique. On the PTX the TX_ADDR must be the same as the RX_ADDR_P0 and as the pipe address for the designated pipe.</p>
<p>Only when a data pipe receives a complete packet can other data pipes begin to receive data. When multiple PTXs are transmitting to a PRX, the ARD can be used to skew the auto retransmission so that they only block each other once.</p>
<h1><a class="anchor" id="autotoc_md210"></a>
ACK Mode</h1>
<p>In some application scenarios, when the MCU of PRX cannot write ACK data content to RAM in a certain time (set by SETUP_VALUE.TX_SETUP_VALUE) after receiving an interrupt, the user can select two different processing methods by setting ACK_CODE. Which mode to use depends on the designer's specific application, increasing the value of SETUP_VALUE.TX_SETUP_VALUE gives the MCU more time to fill in the ACK packet.</p>
<p><b>ACK Mode 0</b></p>
<p>If PRX is set to ACK mode_0, when PRX replies to the ACK package, if the MCU is too late to fill in the ACK package to system RAM, PRX abandons the ACK package reply and wait for PTX to retransmit.</p>
<p><b>ACK Mode 1</b></p>
<p>If PRX is set to ACK mode_1, when PRX replies to ACK packet, if the MCU is too late to fill in the ACK package to system RAM, PRX will automatically reply to empty packet.</p>
<dl class="section note"><dt>Note</dt><dd>The hardware determines whether the MCU fills in the ACK package by judging whether the MCU has written the DMA_TX_LEN register. Therefore, when the MCU writes the ACK package, it should first write data to the RAM and finally write the DMA_TX_LEN register.</dd></dl>
<h1><a class="anchor" id="autotoc_md211"></a>
ACK  Frame  A</h1>
<p>This section describes several scenarios for the protocol engine automatic transaction handling for frame A. The call outs in this section’s figures indicate the IRQs and other events. For MCU activity the event may be placed at a different timeframe.</p>
<dl class="section note"><dt>Note</dt><dd>The figures in this section indicate the earliest possible download (DL) of the packet to the MCU and the latest possible upload (UL) of payload to the transmitter.</dd></dl>
<p><b>Single transaction with ACK packet and interrupts</b></p>
<p>In Figure, the basic auto acknowledgement for frame A is shown. After the packet is transmitted by the PTX and received by the PRX the ACK packet is transmitted from the PRX to the PTX. The RX_DR IRQ is asserted after the packet is received by the PRX, whereas the TX_DS IRQ is asserted when the packet is acknowledged and the ACK packet is received by the PTX.</p>
<div class="image">
<img src="ack_packet_A.png" alt=""/>
<div class="caption">
ACK packet A</div></div>
    <p><b>Single transaction with a lost packet</b></p>
<p>Figure is a scenario for frame A where a retransmission is needed due to loss of the first packet transmits. After the packet is transmitted, the PTX enters RX mode to receive the ACK packet. After the first transmission, the PTX waits a specified time (including setup time, RX_TM and ARD) for the ACK packet, if it is not in the specific time slot the PTX retransmits the packet as shown in Figure. PTX will turn to RX mode after trx_setup us when packet is transmitted, after trx_timeout us (RX_TM is RX timeout for PTX), then PTX turn to ARD (can be set to 0us, 256us, 512us to 3840us).</p>
<div class="image">
<img src="ack_lost_packet_A.png" alt=""/>
<div class="caption">
ack lost packet A</div></div>
    <p>When an address is detected the PTX stays in RX mode until the packet is received. When the retransmitted packet is received by the PRX (see Figure). The RX_DR IRQ is asserted and an ACK is transmitted back to the PTX. When the ACK is received by the PTX, the TX_DS IRQ is asserted.</p>
<p><b>Single transaction with a lost ACK packet</b></p>
<p>Figure is a scenario where a retransmission is needed after a loss of the ACK packet. The corresponding interrupts are also indicated.</p>
<div class="image">
<img src="lost_ack_packet_A.png" alt=""/>
<div class="caption">
lost ack packet A</div></div>
    <p><b>Single transaction with ACK payload packet</b></p>
<p>Figure is a scenario of the basic auto acknowledgement with payload. After the packet is transmitted by the PTX and received by the PRX the ACK packet with payload is transmitted from the PRX to the PTX. The RX_DR IRQ is asserted after the packet is received by the PRX, whereas on the PTX side the TX_DS IRQ is asserted when the ACK packet is received by the PTX. On the PRX side, the TX_DS IRQ for the ACK packet payload is asserted after a new packet from PTX is received. The position of the IRQ in Figure shows where the MCU can respond to the interrupt.</p>
<div class="image">
<img src="ack_payload_packet_A.png" alt=""/>
<div class="caption">
ack payload packet A</div></div>
    <p><b>Single transaction with ACK payload packet and lost packet</b></p>
<p>Figure is a scenario where the first packet is lost and a retransmission is needed before the RX_DR IRQ on the PRX side is asserted. For the PTX both the TX_DS and RX_DR IRQ are asserted after the ACK packet is received. After the second packet (PID = 2) is received on the PRX side both the RX_DR (PID = 2) and TX_DS (ACK packet payload) IRQ are asserted.</p>
<div class="image">
<img src="ack_pkt_lost_pkt_A.png" alt=""/>
<div class="caption">
ack pkt lost pkt A</div></div>
    <h1><a class="anchor" id="autotoc_md212"></a>
ACK  Frame  B</h1>
<p>This section describes several scenarios for the Protocol engine automatic transaction handling for frame B. The call outs in this section’s figures indicate the IRQs and other events. For MCU activity the event may be placed at a different timeframe.</p>
<p><b>The biggest difference is that frame B has an automatic ack mechanism but no retransmission mechanism, because frame B has no PID field.</b></p>
<dl class="section note"><dt>Note</dt><dd>The figures in this section indicate the earliest possible download (DL) of the packet to the MCU and the latest possible upload (UL) of payload to the transmitter.</dd></dl>
<p><b>Single transaction with ACK packet and interrupts</b></p>
<p>In Figure, the basic auto acknowledgement for frame A is shown. After the packet is transmitted by the PTX and received by the PRX the ACK packet is transmitted from the PRX to the PTX. The RX_DR IRQ is asserted after the packet is received by the PRX, whereas the TX_DS IRQ is asserted when the packet is acknowledged and the ACK packet is received by the PTX.</p>
<div class="image">
<img src="ack_packet_B.png" alt=""/>
<div class="caption">
ack packet B</div></div>
    <p><b>Single transaction with a lost packet</b></p>
<p>PTX waits for a period of time before entering the receiving mode. When PTX does not receive an ACK packet after a certain period of time, a timeout interrupt occurs. Or a CRC error interrupt occurs after receiving a packet with CRC error. Since B frames do not have an automatic retransmission function, the software needs to decide whether to continue retransmitting the previous packet or transmit a new packet.</p>
<p>The RX_DR IRQ is asserted and an ACK is transmitted back to the PTX. When the ACK is received by the PTX, the TX_DS IRQ is asserted.</p>
<dl class="section note"><dt>Note</dt><dd>When a receive CRC interrupt is generated, a Maximum retransmission interrupt is also generated.</dd></dl>
<div class="image">
<img src="ack_lost_packet_B.png" alt=""/>
<div class="caption">
ack lost packet B</div></div>
    <h1><a class="anchor" id="autotoc_md213"></a>
Auto Retry</h1>
<p>Only frame A support auto retransmission (ART) is a function.</p>
<p>The auto retransmission is a function that retransmits a packet if an ACK packet is not received. It is used in an auto acknowledgement system on the PTX. When a packet is not acknowledged, you can set the number of times it is allowed to retransmit by setting the FA_SETUP_RETR.ARC register. PTX enters RX mode and waits a time period for an ACK packet each time a packet is transmitted. The amount of time the PTX is in RX mode is based on the following conditions:</p>
<p>• Auto retransmit delay (ARD) has elapsed.</p>
<p>• No address match within 256 us.</p>
<p>• After received packet (CRC correct or not) if address match within 256 us.</p>
<p>The RF transceiver asserts the TX_DS IRQ when the ACK packet is received.</p>
<p>The RF transceiver enters Standby-I mode if there is no more un-transmitted data in the TX FIFO and the register MAC_CE is low. If the ACK packet is not received, the RF transceiver goes back to TX mode after a delay defined by FA_SETUP_RETR.ARD and retransmits the data. This continues until acknowledgment is received, or the maximum number of retransmits is reached.</p>
<p>Two packet loss counters are incremented each time a packet is lost, FA_OBSERVE_TX.ARC_CNT and FA_OBSERVE_TX.PLOS_CNT in the FA_OBSERVE_TX register. The ARC_CNT counts the number of retransmissions for the current transaction. You reset ARC_CNT by initiating a new transaction. The PLOS_CNT counts the total number of retransmissions since the last channel change. You reset PLOS_CNT by writing to the RF_CH register. It is possible to use the information in the FA_OBSERVE_TX register to make an overall assessment of the channel quality.</p>
<p>The FA_SETUP_RETR.ARD defines the time from the end of a transmitted packet to when a retransmit start on the PTX. FA_SETUP_RETR.ARD register is set in steps of 256μs. A retransmit is made if no ACK packet is received by the PTX.</p>
<p>There is a restriction on the length of FA_SETUP_RETR.ARD when using ACK packets with payload. The FA_SETUP_RETR.ARD time must never be shorter than the sum of the startup time and the time on-air for the ACK packet.</p>
<p>• For 2 Mbps data rate; 15 bytes is maximum ACK packet payload length for ARD = 256μs (reset value).</p>
<p>• For 1 Mbps data rate; 5 bytes is maximum ACK packet payload length for ARD = 256μs (reset value).</p>
<h2><a class="anchor" id="autotoc_md214"></a>
Standby Mode</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Mode   </th><th class="markdownTableHeadLeft">Register PKTCTRL0.PRIM_RX   </th><th class="markdownTableHeadLeft">Register MAC_CE   </th><th class="markdownTableHeadLeft">FIFO State    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">RX Mode   </td><td class="markdownTableBodyLeft">1   </td><td class="markdownTableBodyLeft">1   </td><td class="markdownTableBodyLeft">indeterminacy    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">TX Mode   </td><td class="markdownTableBodyLeft">0   </td><td class="markdownTableBodyLeft">Minimum 10us high pulse   </td><td class="markdownTableBodyLeft">Data TX FIFO Will empty    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Standby-II   </td><td class="markdownTableBodyLeft">0   </td><td class="markdownTableBodyLeft">1   </td><td class="markdownTableBodyLeft">TX FIFO empty    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Standby-I   </td><td class="markdownTableBodyLeft">1/0   </td><td class="markdownTableBodyLeft">0   </td><td class="markdownTableBodyLeft">No ongoing packet transmission   </td></tr>
</table>
<p><b>Standby-I Mode</b></p>
<p>After clock is ready, the device enters Standby-I mode. Standby-I mode is used to minimize average current consumption. In this mode only part of the crystal oscillator is active. Change to active modes only happens if register MAC_CE is set high and when register MAC_CE is set low, the OM6XXX returns to Standby-I mode from both the TX and RX modes.</p>
<p><b>Standby-II Mode</b></p>
<p>In standby-II mode MAC clock are active and more current is used compared to Standby-I mode. The chip enters standby-II mode if register MAC_CE is held high on a PTX device with an empty TX FIFO, If a new packet is uploaded to the TX FIFO.</p>
<dl class="section note"><dt>Note</dt><dd>From Standby-I mode to standby-II mode register MAC_CE more than 10us.</dd></dl>
<h1><a class="anchor" id="autotoc_md215"></a>
PTX Mode</h1>
<p>The TX mode is an active mode for transmitting packets. To enter this mode, the MCU must set PKTCTRL0.PRIM_RX bit set low or by drv_om24g_switch_role(OM24G_ROLE_PTX) API, several payload data move to TX FIFO by DMA and a high pulse on the register MAC_CE for more than 10µs.</p>
<p>This operating mode pulses the register MAC_CE high for at least 10µs. This allows one packet to be transmitted. This is the normal operating mode. After the packet is transmitted, the chip enters STANDBY-I mode.</p>
<p>For OM6XXX to go to TX or RX mode it must first pass through stand-by mode.</p>
<p>The flowchart in Figure outlines how a RF transceiver configured as a PTX behaves after entering Standby-I mode.</p>
<div class="image">
<img src="ptx_mode.png" alt=""/>
<div class="caption">
ptx_mode</div></div>
    <p>Activate PTX mode by setting the register MAC_CE high. If there is a packet present in the TX FIFO, the RF transceiver enters TX mode and transmits the packet. If Auto Retransmit is enabled, the state machine checks if the NO_ACK flag is set. If it is not set, the RF transceiver enters RX mode to receive an ACK packet. If the received ACK packet is empty, only the TX_DS IRQ is asserted. If the ACK packet contains a payload, both TX_DS IRQ and RX_DR IRQ are asserted simultaneously before the RF transceiver returns to Standby-I mode.</p>
<p>If the ACK packet is not received before timeout occurs, the RF transceiver returns to standby-II mode. For frame A, it stays in standby-II mode until the FA_SETUP_RETR.ARD has elapsed. If the number of retransmits has not reached the FA_SETUP_RETR.ARC, the RF transceiver enters TX mode and transmits the last packet once more.</p>
<p>While executing the auto retransmit feature, the number of retransmits can reach the maximum number defined in FA_SETUP_RETR.ARC. If this happens, the RF transceiver asserts the MAX_RT IRQ and returns to Standby-I mode.</p>
<p>If the register MAC_CE register is high and the TX FIFO is empty, the RF transceiver enters Standby-II mode.</p>
<h1><a class="anchor" id="autotoc_md216"></a>
PRX Mode</h1>
<p>The RX mode is an active mode where the OM6XXX radio is used as a receiver. To enter this mode, the chip must have the PKTCTRL0.PRIM_RX bit and the register MAC_CE set high or by drv_om24g_switch_role(OM24G_ROLE_PRX) API.</p>
<p>In RX mode the receiver demodulates the signals from the RF channel, constantly presenting the demodulated data to the baseband protocol engine. The baseband protocol engine constantly searches for a valid packet. If a valid packet is found (by a matching address and a valid CRC) the payload of the packet is presented in a vacant slot in the RX FIFO, meanwhile DMA will move RX FIFO data to system RAM until a complete packet is received.</p>
<p>The MAC mains in RX mode until the MCU configures it to Standby-I mode. However, if the automatic protocol features in the baseband protocol engine are enabled, the chip can enter other modes in order to execute the protocol.</p>
<p>The flowchart in Figure outlines how a RF transceiver configured as a PRX behaves after entering Standby-I mode.</p>
<div class="image">
<img src="prx_mode.png" alt=""/>
<div class="caption">
prx mode</div></div>
    <p>Activate PRX mode by setting the register MAC_CE high. The RF transceiver enters RX mode and starts searching for packets. If a packet is received and auto acknowledgement is enabled, the RF transceiver decides if the packet is new or a copy of a previously received packet. If the packet is new payload is made available in the RX FIFO and the RX_DR IRQ is asserted. If the last received packet from the transmitter is acknowledged with an ACK packet with payload, the TX_DS IRQ indicates that the PTX received the ACK packet with payload. For frame A, if the NO_ACK flag is not set in the received packet, the PRX enters TX mode. If there is a pending payload in the TX FIFO it is attached to the ACK packet. After the ACK packet is transmitted, the RF transceiver returns to RX mode.</p>
<p>A copy of a previously received packet might be received if the ACK packet is lost. In this case, the PRX discards the received packet and transmits an ACK packet before it returns to RX mode. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
</div>
</body>
</html>
