<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!-- BEGIN opengraph metadata -->
<meta property="og:title" content="Doxygen Awesome" />
<meta property="og:image" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta property="og:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<meta property="og:url" content="https://jothepro.github.io/doxygen-awesome-css/" />
<!-- END opengraph metadata -->
<!-- BEGIN twitter metadata -->
<meta name="twitter:image:src" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta name="twitter:title" content="Doxygen Awesome" />
<meta name="twitter:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<!-- END twitter metadata -->
<title>User Guide: ble_om24g_app_simple</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/svg+xml" href="logo.drawio.svg"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/
<a href="https://github.com/jothepro/doxygen-awesome-css" class="github-corner" title="View source on GitHub" target="_blank">
    <svg viewBox="0 0 250 250" width="40" height="40" style="position: absolute; top: 0; border: 0; right: 0; z-index: 99;" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
-->
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">User Guide
   </div>
   <div id="projectbrief">Bluetooth Low Energy 5.4</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('BLE_OM24G_APP_SIMPLE.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">ble_om24g_app_simple </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_doxygen_source_24g_ble_om24g_app_simple"></a> </p>
<h1><a class="anchor" id="autotoc_md221"></a>
Building</h1>
<p>The ble and 24g coexist example is under <code>SDK\projects\ble_om24g_app_simple</code> in the SDK folder structure. In order to achieve the coexistence scheme of BLE and 24g, Perform the following steps to set up an application:</p>
<p>1、Initialize 2.4GHz Proprietary protocol using <a class="el" href="group__OM24G.html#ga446564d9dced67dbc1d1a03c95c83299" title="init the 2.4g transerive when the event begin. If the deviation is dynamically switched,...">drv_om24g_init(const om24g_config_t *cfg)</a> You can use the default parameters in om24g_config as starting point for the cfg parameter and reconfigure them if needed.</p>
<p>2、Initialize the Bluetooth module by calling omble_init(&amp;param).</p>
<p>3、If necessary, use any of the folowing functions to update the addresses, the channel, and the bitrate:</p>
<ul>
<li><a class="el" href="group__OM24G.html#gac48dff912cde9bf68a4069cb1ab480d4" title="set RX check_address value.">drv_om24g_set_addr(uint8_t pipenum, uint8_t addr)</a></li>
<li><a class="el" href="group__OM24G.html#ga43dc04c9a58b35d31dbb21e3ae16a444" title="Set 2.4G frequency point.">drv_om24g_set_freq(uint16_t freq, float fract_freq)</a></li>
<li><a class="el" href="group__OM24G.html#ga0622fa284faad1ea906cc5b0259de699" title="Set transmission rate, frequency point. The speed only allows the use of speeds listed in enumeration...">drv_om24g_set_rf_parameters(om24g_rate_t data_rate, uint16_t frequency, float fract_freq)</a></li>
</ul>
<dl class="section note"><dt>Note</dt><dd>drv_om24g_set_rf_parameters must be used to configure the rate, which has configured the frequency offset, but drv_om24g_set_rate has not configured the frequency offset.</dd></dl>
<p>4、drv_om24g_control(OM24G_CONTROL_CLK_ENABLE, NULL) can turn on the 24G clock，drv_om24g_control(OM24G_CONTROL_CLK_DISABLE, NULL) can turn off the 24G clock. The clock has been turned on by om24g_init by default.</p>
<p>5、BLE broadcasting and 24g sending packets:</p>
<ul>
<li>Call the following function to start broadcasting: <a class="el" href="group__BLE__APP__SIMPLE.html#ga03beb2a99084db30c803351ad3cc42d0">app_adv_init()</a>;<a class="el" href="group__BLE__APP__SIMPLE.html#ga2e209018b8ce32a2f3f5b16ab6d63c7d">app_sec_init()</a>;<a class="el" href="group__BLE__APP__SIMPLE.html#gac4ab347efc8b4c4253cebcaa76c57334">service_common_init()</a>; app_om_dfu_init();<a class="el" href="group__BLE__APP__SIMPLE.html#ga110b1d5f68c5aa228cbc3f52e902150a">ancs_client_init()</a>; <a class="el" href="group__BLE__APP__SIMPLE.html#ga77b721ce5433732e7ced6f560737b577">app_tspp_init()</a>; app_wechat_lite_init();</li>
<li>Registering Callbacks by calling drv_om24g_register_event_callback(om24g_callback).</li>
<li>Add packets to the TX FIFO by calling drv_om24g_write_int(uint8_t *tx_payload, uint8_t tx_num).</li>
<li>Wait for an event interrupt in the callback function.<ul>
<li>In no ack mode, wait until event DRV_EVENT_COMMON_TRANSMIT_COMPLETED represents successful transmission.</li>
<li>In ack mode, event DRV_EVENT_COMMON_TRANSMIT_COMPLETED is triggered only when a response packet is received, indicating successful transmission. Otherwise, the transmission fails and triggers event DRV_EVENT_OM24G_MAX_RT(max retry).</li>
</ul>
</li>
</ul>
<p>6、BLE broadcasting and 24g receiving packets:</p>
<ul>
<li>Registering Callbacks by calling drv_om24g_register_event_callback(om24g_callback).</li>
<li>Call drv_om24g_read_int(uint8_t *rx_payload) to turn on the RF and start receiving.</li>
<li>Handle DRV_EVENT_COMMON_RECEIVE_COMPLETED events as packets are coming in.<ul>
<li>in no ack mode, wait until event DRV_EVENT_COMMON_RECEIVE_COMPLETED represents successful transmission.</li>
<li>In ack mode, to attach payloads to acknowledgment packets, add them to the TX FIFO using <a class="el" href="group__OM24G.html#ga919b2d84e83d74e1587bcdecd8e47dab" title="write ack data to transmit FIFO.">drv_om24g_write_ack(uint8_t tx_num)</a>. The payload must be queued after a packet is received. After a queued payload is sent with an acknowledgment, Only after receiving the next new packet with different PID values, an DRV_EVENT_COMMON_TRANSMIT_COMPLETED event is only queued.</li>
</ul>
</li>
</ul>
<p>7、Register callback function obc_bb_frame_ongoing_callback_register(app_24g_ble_bb_frame_ongoing_handler) and global variable is_ongoing, coordinate BLE and 24G time-sharing work.</p>
<h1><a class="anchor" id="autotoc_md222"></a>
Example</h1>
<p>This example describes the periodic broadcasting of BLE, which can be tested by scanning the connection through mobile app nRF Connect. During BLE's idle time, the RF switches to 24G to monitor airborne packets. You can use the om24g_app_simple example to perform packet testing on another chip.</p>
<p>The following are specific configurations for devices:</p>
<ul>
<li>This chip can interconnect with 24g chips from multiple manufacturers and is compatible with om662x, nordic, TI, siliconlabs, default compatible with om662x, can be modified through the macro definition RTE_OM24G_RF_MODE in RTE_om6626.h (0: Compatible with om66XX 1: Compatible with TI2640 2: Compatible with SILICONLAB 3: Compatible with NORDIC).</li>
<li>Modify the macro definition TX_ROLE in app_om24g.c to 0 representing the receiving device.</li>
<li>Call app_24g_init(void) to receive package of format B in interrupt mode. In callback function om24g_callback(), waiting until event DRV_EVENT_COMMON_RECEIVE_COMPLETED is triggered represents successful receiving.</li>
<li>Call omble_init(&amp;param) Initialize the ble module.</li>
<li>When Bluetooth is working, the variable is_ongoing is set to 1, and the 24G RF reception is turned off in the callback function app_24g_ble_bb_frame_ongoing_handler(). After the ble work is completed, set the variable is_ongoing to 0, turn on the 24g clock, and start receiving in the callback function.</li>
</ul>
<h1><a class="anchor" id="autotoc_md223"></a>
Running And Testing</h1>
<p>After programming the ble_om24g_app_simple on one of the development kits and the om24g_app_simple on the other kit, test them by performing the following steps:</p>
<ul>
<li>Connect the serial ports GPO5,6 to the upper computer of the serial assistant.</li>
<li>First power on the ble and 24g coexist device, then power on the om24g_app_simple 24g TX device.</li>
<li>Scan for the presence of om6627 ble devices through mobile app nRF Connect, as shown in the following figure.</li>
<li>Observe the logging output for both kits.</li>
</ul>
<div class="image">
<img src="nrf_connect.png" alt=""/>
<div class="caption">
nrf_connect</div></div>
     </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
</div>
</body>
</html>
