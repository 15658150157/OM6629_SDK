<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!-- BEGIN opengraph metadata -->
<meta property="og:title" content="Doxygen Awesome" />
<meta property="og:image" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta property="og:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<meta property="og:url" content="https://jothepro.github.io/doxygen-awesome-css/" />
<!-- END opengraph metadata -->
<!-- BEGIN twitter metadata -->
<meta name="twitter:image:src" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta name="twitter:title" content="Doxygen Awesome" />
<meta name="twitter:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<!-- END twitter metadata -->
<title>User Guide: BLE OTA</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/svg+xml" href="logo.drawio.svg"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/
<a href="https://github.com/jothepro/doxygen-awesome-css" class="github-corner" title="View source on GitHub" target="_blank">
    <svg viewBox="0 0 250 250" width="40" height="40" style="position: absolute; top: 0; border: 0; right: 0; z-index: 99;" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
-->
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">User Guide
   </div>
   <div id="projectbrief">Bluetooth Low Energy 5.4</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('BLE_OTA.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">BLE OTA </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This article introduces the principle and usage of the OTA function.</p>
<h1><a class="anchor" id="autotoc_md145"></a>
Principle of OTA</h1>
<p>The program flashing the new firmware to the program backup area of the flash through Bluetooth, restarts the device after completing the transmission and verification, and the bootloader copies the new firmware in the backup area to the designated area and runs the new firmware In addition, the OTA also supports overwriting data in any position of the configuration file or flash</p>
<div class="plantumlgraph">
<img src="inline_umlgraph_2.png" />
</div>
<h1><a class="anchor" id="autotoc_md146"></a>
Generation of OTA upgrade package</h1>
<p>After the program is compiled to generate a bin file, use the CreateFwTool.exe tool to generate an upgrade package for the upgrade tool to upgrade </p>
<h2><a class="anchor" id="autotoc_md147"></a>
DFU function configuration in project code</h2>
<p>To use the OTA function, you need to add the Bluetooth profile onmicro_dfu to the source code If necessary, you can manually configure onmicro_dfu_config.h to specify the address range of the program backup area </p>
<h2><a class="anchor" id="autotoc_md148"></a>
CreateFwTool tool introduction</h2>
<p>The CreateFwTool tool is used to convert the bin file into an upgrade package, and all functions can be viewed with the CreateFwTool.exe &ndash;help command </p><div class="fragment"><div class="line">Usage: CreateFwTool [OPTION...] [keygen|pack|stick] ...</div>
<div class="line">Pack image or generate <span class="keyword">private</span>/<span class="keyword">public</span> key.</div>
<div class="line">#   Generate <span class="keyword">private</span>/<span class="keyword">public</span> key : CreateFwTool.exe keygen</div>
<div class="line">  or</div>
<div class="line"><span class="preprocessor">#   Generate public key from private key : CreateFwTool.exe keygen &quot;filename&quot;</span></div>
<div class="line">  or</div>
<div class="line"><span class="preprocessor">#   Generate DFU packet: CreateFwTool.exe pack [image info]xN</span></div>
<div class="line">        [image info] : [filename type(non-RAW) version]</div>
<div class="line">        [image info] : [filename type(RAW)     nvds_itf  address]</div>
<div class="line"> </div>
<div class="line">  -d, --dummy_reset[=file size]   Add dummy image <span class="keywordflow">for</span> reseting device</div>
<div class="line">  -m, --manual_app_version   Set app version manually instead of reading from image</div>
<div class="line">  -o, --output=filename      Output filename(<span class="keywordflow">default</span>:OmFwYYmmddHHMM.zip)</div>
<div class="line">  -s, --signature=key file   Signture with the <span class="keyword">private</span> key</div>
<div class="line">  -v, --vrom_app=idx         Specify the index value used by the VROM application</div>
<div class="line">  -h, --help                 give <span class="keyword">this</span> help list</div>
<div class="line"> </div>
<div class="line"> Example:</div>
<div class="line">   Generate DFU packet. (app only):</div>
<div class="line">     CreateFwTool.exe pack app.bin APP 0x0001</div>
<div class="line">   Generate DFU packet. (app and raw.bin):</div>
<div class="line">     CreateFwTool.exe pack app.bin APP 0x0001 raw.bin RAW 0x0001 0x20000</div>
<div class="line">   Generate DFU packet. (app only with signature):</div>
<div class="line">     CreateFwTool.exe pack app.bin APP 0x0001 -s priv_key.hex</div>
<div class="line"> </div>
<div class="line">Report bugs to &lt;feng.shang@onmicro.com.cn&gt;</div>
<div class="line">Onmicro DFU Package Creater v1.4.220424</div>
</div><!-- fragment --> <h2><a class="anchor" id="autotoc_md149"></a>
OTA packet generation</h2>
<p>If the name of the bin file is firmware.bin, you can use the following command to convert the bin file into an upgrade package </p><div class="fragment"><div class="line">CreateFwTool.exe  pack  firmware.bin  APP  0x6621E100  -o  OmFw6621E.zip</div>
</div><!-- fragment --><p> Among them, 'pack' means to generate an upgrade package, 'firmware.bin' is the firmware bin file, 'APP' specifies that the object of the upgrade is the main program of the device, '0x6621E100' means the version number of the APP, which is customized by the user, the '-o' parameter is used to specify the output file name, and finally Generate the upgrade package file "OmFw6621E.zip"</p>
<p>After running successfully, the console outputs the following text </p><div class="fragment"><div class="line">DFU Version: 0x00000003</div>
<div class="line">Control Field: 0x0000</div>
<div class="line">Image 1:</div>
<div class="line">        Filename: firmware.bin</div>
<div class="line">        Type:     0x00000000(APP)</div>
<div class="line">        Version:  0x6621E100</div>
<div class="line">        Size:     23456</div>
<div class="line"> </div>
<div class="line">Package Info:</div>
<div class="line">55 DF BF 01 03 00 00 00 00 00 01 00 00 00 F9 A7</div>
<div class="line">00 E1 21 66 A0 5B 00 00</div>
<div class="line">Total Cmd Size: 24</div>
<div class="line">Total Image Size: 23456</div>
<div class="line">Firmware OmFw6621E.zip created.</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md150"></a>
Introduction to Mobile Phone Upgrade Tool</h1>
<p>DfuUpload.apk is an Android application that cooperates with the Bluetooth DFU profile on the device side to realize the upgrade function.</p>
<p>The operation process is as follows: select the file, select the device, start the upgrade, and complete the upgrade. </p>
<h1><a class="anchor" id="autotoc_md151"></a>
Mobile terminal upgrade operation process</h1>
<h2><a class="anchor" id="autotoc_md152"></a>
Click "Select File" to select the upgrade package file</h2>
<div class="image">
<img src="DFU_1_select_file.jpg" alt=""/>
<div class="caption">
Select Firmwire packet file</div></div>
 <h2><a class="anchor" id="autotoc_md153"></a>
Click "Select Device" to select the device to be upgraded</h2>
<div class="image">
<img src="DFU_2_select_device.jpg" alt=""/>
<div class="caption">
Select Device</div></div>
 <h2><a class="anchor" id="autotoc_md154"></a>
Click "StartUpgrading" to start upgrading</h2>
<div class="image">
<img src="DFU_3_uploading.jpg" alt=""/>
<div class="caption">
Uploading files</div></div>
 <h2><a class="anchor" id="autotoc_md155"></a>
Wait for the prompt after the upgrade is complete</h2>
<div class="image">
<img src="DFU_4_finished.jpg" alt=""/>
<div class="caption">
OTA finished</div></div>
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
</div>
</body>
</html>
