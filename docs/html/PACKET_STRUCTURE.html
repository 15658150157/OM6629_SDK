<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!-- BEGIN opengraph metadata -->
<meta property="og:title" content="Doxygen Awesome" />
<meta property="og:image" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta property="og:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<meta property="og:url" content="https://jothepro.github.io/doxygen-awesome-css/" />
<!-- END opengraph metadata -->
<!-- BEGIN twitter metadata -->
<meta name="twitter:image:src" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta name="twitter:title" content="Doxygen Awesome" />
<meta name="twitter:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<!-- END twitter metadata -->
<title>User Guide: Packet Structure</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/svg+xml" href="logo.drawio.svg"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/
<a href="https://github.com/jothepro/doxygen-awesome-css" class="github-corner" title="View source on GitHub" target="_blank">
    <svg viewBox="0 0 250 250" width="40" height="40" style="position: absolute; top: 0; border: 0; right: 0; z-index: 99;" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
-->
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">User Guide
   </div>
   <div id="projectbrief">Bluetooth Low Energy 5.4</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('PACKET_STRUCTURE.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Packet Structure </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_doxygen_source_24g_packet_structure"></a> The structure of the Protocol engine packet is described in this section. There are two optional packet formats, structure A and structure B, this is configured through <a class="el" href="structom24g__config__t.html#a9c054c410f78c79f59ae1d9338d5eaee">om24g_config_t::packet_struct_sel</a>.</p>
<p>The Protocol engine packet contains a preamble field, sync word field, header field, payload field, payload field, timestamp field and a CRC field.</p>
<h1><a class="anchor" id="autotoc_md181"></a>
Packet   Structure   A</h1>
<p>In packet structure A, All field dashed block in Figure is optional, the payload field is only optional in an empty ACK packet. All subfields in header is also optional field. If PCF field is existing, all subfields in PCF is also optional field.</p>
<p>The structure A can communicate with the ESB protocol of Nordic chips and the onmicro 66xx private protocol.</p>
<div class="image">
<img src="Pkt_structure_A.png" alt=""/>
<div class="caption">
Packet structure A</div></div>
    <p>If configure packet structure to be structure A, 2.4G MAC has the following characteristics:</p>
<ul>
<li>Auto acknowledge and retransition function.</li>
</ul>
<h2><a class="anchor" id="autotoc_md182"></a>
Preamble Field</h2>
<ul>
<li>The preamble is a bit sequence used to synchronize the receiver’s demodulator to the incoming bit stream. The preamble length is configurable from 0 to 31 bytes. Preamble value is configurable.</li>
<li>The entire preamble num consist of both PREAMBLE_LEN(range 0~31bytes) register and PRE_GUARD.PREGRD_CNT(range 0~15bits) register.</li>
<li>preamble num = PREAMBLE_LEN*8+ PREGRD_CNT (must set PRE_GUARD.PREGRD_EN = 1).<ul>
<li>The preamble is sent is done to ensure there are enough transitions in the preamble to stabilize the receiver.</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md183"></a>
Sync Word Field</h2>
<ul>
<li>Byte synchronization is achieved by a continuous sync word search. The sync word is inserted at the start of the packet by the modulator in transmit mode. The demodulator uses this field to find the byte boundaries in the stream of bits. The content of the sync word can be set, and length of sync word is 4 bytes.</li>
<li>Two sync words can be defined in the chip. The radio either search for sync word_0 only (default operation) or both(sync word_0 and sync word_1). The dual synchronous word synchronization function can be enabled through REGW(&amp;OM_PHY-&gt;RX_GFSK_SYNC_CTRL, <a class="el" href="group__UTILS.html#ga9ba0a9346ed51dd53f97848bdb81a83a">MASK_1REG(PHY_RX_GFSK_SYNC_CTRL_EN_2ND_ADDR, 1)</a>).</li>
<li>The sync word will also function as a system identifier since only packets with the correct predefined sync word will be received. The correlation threshold can be set to a number of bits’ match.</li>
<li><p class="startli">Both byte endian and bit endian for sync word field is configurable, please refer to Chapter MSB/LSB endian for details.</p>
<dl class="section note"><dt>Note</dt><dd>If the sync word needs to be modified, the receiver needs to call OM24G_CE_LOW() to turn off the RF.</dd></dl>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md184"></a>
Packet Control Field</h2>
<ul>
<li>If packet structure A is selected(<a class="el" href="structom24g__config__t.html#a9c054c410f78c79f59ae1d9338d5eaee">om24g_config_t::packet_struct_sel</a> = OM24G_STRUCTURE_A), the PCF field may be existing in packet. Figure shows the structure of the packet control field, MSB to the left. The size of PCF is 9 bits or 13bits. <br  />
</li>
</ul>
<div class="image">
<img src="Packet_Control_Field.png" alt=""/>
<div class="caption">
Packet Control Field</div></div>
    <ul>
<li>The packet control field contains a 6 bits’ or 10bits' length field, a 2-bit PID (Packet Identity) field and a 1 bit NO_ACK flag.</li>
<li>If payload with auto ACK function or dynamic payload length function is enable, PCF subfield will presence.</li>
</ul>
<p><b>1) Length</b></p>
<ul>
<li>Supports two types of payload configuration: fixed packet length and dynamic packets length.</li>
<li>Fixed or dynamic packets length mode can be used for packets up to 63/1023 bytes. The length field bit is expanded from 6 bits to 10 bits by setting FA_PKTCTRL.LEN_10B_EN. Fixed packet length mode is selected by setting <a class="el" href="structom24g__config__t.html#a4580e6df18b2c7aeaeb5710d22436773" title="Enable dynamic length.">om24g_config_t::dpl_en</a> = 0. <a class="el" href="structom24g__config__t.html#a0f16b3277f49cf81a21f21524e001397" title="In fixed length mode, it is the length of the receiving and sending. In dynamic length mode,...">om24g_config_t::static_len</a> defines the maximum length in dynamic packet mode, and length cannot be greater than static_ Len.</li>
<li>In dynamic packets length Mode, the length field specifies the length of the payload in bytes. The length of the payload can be from 0 to 63/1023 bytes.</li>
<li>Coding: <a class="el" href="structom24g__config__t.html#a0f16b3277f49cf81a21f21524e001397" title="In fixed length mode, it is the length of the receiving and sending. In dynamic length mode,...">om24g_config_t::static_len</a> = 0x00 (0 byte, only used in empty ACK packets), <a class="el" href="structom24g__config__t.html#a0f16b3277f49cf81a21f21524e001397" title="In fixed length mode, it is the length of the receiving and sending. In dynamic length mode,...">om24g_config_t::static_len</a> = 0x3f (63 bytes).</li>
<li>This field is only used if the Dynamic Payload Length function is enabled.</li>
</ul>
<p><b>2)</b> <b>PID (Packet Identification)</b></p>
<p>The 2-bit PID field is used to detect if the received packet is new or retransmitted. PID prevents the PRX operation from presenting the same payload more than once to the MCU. The PID field is incremented at the TX side for each new packet. The PID and CRC field are used by the PRX operation to determine if a packet is retransmitted or new. When several data packets are lost on the link, the PID fields may become equal to the last received PID. If a packet has the same PID as the previous packet, the RF transceiver compares the CRC sums from both packets. If the CRC sums are also equal, the last received packet is considered a copy of the previously received packet and discarded.</p>
<p><b>3)</b> <b>No Acknowledgment Flag (NO_ACK)</b></p>
<ul>
<li>The selective auto acknowledgement feature controls the NO_ACK flag.</li>
<li>This flag is only used when the auto acknowledgement feature is used. Setting the flag high, tells the receiver that the packet is not to be auto acknowledged.</li>
<li>On the PTX you can set the NO_ACK flag bit in the Packet Control Field with writing FA_PKTCTRL.NO_ACK = 1.</li>
<li>However, the function must first be enabled in the FEATURE register by setting the FA_PKTCTRL.EN_DYN_ACK bit. When you use this option, the PTX goes directly to Standby-I mode after transmitting the packet. when FA_PKTCTRL.NO_ACK is 1, the PRX does not transmit an ACK packet when it receives the packet.</li>
</ul>
<h2><a class="anchor" id="autotoc_md185"></a>
Payload Field</h2>
<ul>
<li>Protocol engine provides two alternatives for handling payload lengths: static and dynamic.</li>
<li>In packet structure A, the payload is the user defined content of the packet. It can be 0 to 63/1023 bytes with dynamic length, when static length is used, the length range of the payload is 0-65535 bytes.</li>
<li>The default is static payload length. With static payload length all packets between a transmitter and a receiver have the same length. Static payload length is set by the PACKET_LEN register on the receiver side. The payload length on the transmitter side is set by the DMA_TX_LEN register and must equal the value in the PACKET_LEN register on the receiver side.</li>
<li>Dynamic Payload Length (DPL) is an alternative to static payload length. DPL enables the transmitter to send packets with variable payload length to the receiver. This means that for a system with different payload lengths it is not necessary to scale the packet length to the longest payload.</li>
<li>With the DPL feature the OM6XXX can decode the payload length of the received packet automatically instead of using the PACKET_LEN registers.</li>
<li>In order to enable DPL, The FEATURE.EN_DPL register must be enabled. In RX mode the DYNPD.DPL_Px(x: 0~5) register must be set. A PTX that transmits to a PRX(pipe0) with DPL enabled must have the DYNPD.DPL_P0 register set.</li>
</ul>
<h2><a class="anchor" id="autotoc_md186"></a>
CRC Field</h2>
<p>The CRC is the error detection mechanism in the packet. In frame A, the scope of CRC is individual optional: includes sync word, 1bytes address field, 2 bytes guard field (if guard field exist), header field, payload and timestamp field.</p>
<dl class="section note"><dt>Note</dt><dd>Structure A only support CRC-8 and CRC-16.</dd></dl>
<h1><a class="anchor" id="autotoc_md187"></a>
Packet  Structure  B</h1>
<p>If configure packet structure to be structure B, the chip has the following characteristics:</p>
<ul>
<li>Frame B support auto acknowledge function, but don’t support automatically retransmits function.</li>
<li>Address1 can be in head field, before or after head field.</li>
<li>If CRC is enabled, CRC coverage includes all field between preamble field and CRC field, for sync_word field, header field, address1 field (if address1 field is not in header field) and timestamp field, CRC calculate can be choose or discard.</li>
<li>If data whitening is enabled, whitening coverage includes all field after sync_word field, for header field, address1 field (if address1 field is not in header field), timestamp field and CRC field, whitening calculate can be choose or discard.</li>
</ul>
<div class="image">
<img src="Pkt_structure_B.png" alt=""/>
<div class="caption">
Packet structure B</div></div>
    <h2><a class="anchor" id="autotoc_md188"></a>
Preamble Field</h2>
<p>Same as Pkt_structure_A.</p>
<h2><a class="anchor" id="autotoc_md189"></a>
Sync  Word Field</h2>
<p>Same as Pkt_structure_A.</p>
<h2><a class="anchor" id="autotoc_md190"></a>
Header Field</h2>
<p>In frame B, there is a configurable header field with follow feature:</p>
<ul>
<li>Optional.</li>
<li>May contain either length, address or both in arbitrary order.</li>
<li>In frame B, size can be 0 to 40 bits. The header can be read through FB_HEADER_L(32bit) and FB_HEADER_H(8bit).</li>
<li>May contain unused data.</li>
</ul>
<p>Example1:</p>
<p>By configuring as follows, the header is shown in the figure.</p>
<p><a class="el" href="structom24g__config__t.html#a54898012e6af062371900d0a23390fac" title="The number of bits in the header.">om24g_config_t::hdr_bits</a> = 0x20</p>
<p><a class="el" href="structom24g__config__t.html#aa437dded2d299603efa54362ed5f277f" title="The location of lenth.">om24g_config_t::len_pos</a> = 0x0</p>
<p><a class="el" href="structom24g__config__t.html#a2be108803d9217ded734154693563385" title="The location of rx pipe address.">om24g_config_t::addr1_pos</a> = 0x10</p>
<p><a class="el" href="structom24g__config__t.html#aa56d0fe9b08718b5bd5d2f63c7f5f517" title="The number of bits in lenth.">om24g_config_t::len_bits</a> = 0x8</p>
<p><a class="el" href="structom24g__config__t.html#a87d39272e5f00e2485a88c812bbdceb0" title="The number of bits in rx pipe address.">om24g_config_t::addr1_bits</a> = 0x8</p>
<p>FB_PKTCTRL. ADDR1_LOC = 0x0</p>
<div class="image">
<img src="header_example1.png" alt=""/>
<div class="caption">
header_example1</div></div>
    <p>Example2:</p>
<p>By configuring as follows, the header is shown in the figure.</p>
<p><a class="el" href="structom24g__config__t.html#a54898012e6af062371900d0a23390fac" title="The number of bits in the header.">om24g_config_t::hdr_bits</a> = 0x10</p>
<p><a class="el" href="structom24g__config__t.html#aa437dded2d299603efa54362ed5f277f" title="The location of lenth.">om24g_config_t::len_pos</a> = 0x8</p>
<p><a class="el" href="structom24g__config__t.html#a2be108803d9217ded734154693563385" title="The location of rx pipe address.">om24g_config_t::addr1_pos</a> = 0x0</p>
<p><a class="el" href="structom24g__config__t.html#aa56d0fe9b08718b5bd5d2f63c7f5f517" title="The number of bits in lenth.">om24g_config_t::len_bits</a> = 0x8</p>
<p><a class="el" href="structom24g__config__t.html#a87d39272e5f00e2485a88c812bbdceb0" title="The number of bits in rx pipe address.">om24g_config_t::addr1_bits</a> = 8</p>
<p>FB_PKTCTRL.ADDR1_LOC = 0x0</p>
<div class="image">
<img src="header_example2.png" alt=""/>
<div class="caption">
header_example2</div></div>
    <h2><a class="anchor" id="autotoc_md191"></a>
Address1 Field</h2>
<p>In frame structure B, adress1 subfield in head field (or before/after head field) will be used for address filter.</p>
<p>This is the address for the receiver. An address ensures that the packet is detected and received by the correct receiver, preventing accidental cross talk between multiple OM6XXX systems. If adress1 subfield is in head field, the size of address1 field is configurable and range from 0 to 8 bits. Or the size of address1 field is fixed 8 bits.</p>
<h2><a class="anchor" id="autotoc_md192"></a>
Payload Field</h2>
<p>Different with frame A, the payload length in Frame B can be 0 to 65535 bytes.</p>
<h3><a class="anchor" id="autotoc_md193"></a>
Timestamp Field</h3>
<p>In a network of multiple device, it is often required that all participants operate on a common time base. In the chip, a radio timer provides 32-bit timestamps at 8 MHz (8 ticks per us).</p>
<h2><a class="anchor" id="autotoc_md194"></a>
CRC Field</h2>
<p>The CRC is the error detection mechanism in the packet. It may calculate over the sync word, header, payload and timestamp field. The scope of CRC for these field is individual optional. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
</div>
</body>
</html>
