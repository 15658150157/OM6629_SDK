/*
 * Function use to execute after reset via uVision reset button
*/

FUNC void pre_load (void) {
    // disable WDT
    execf("_WDWORD(0x400E00E8, 0x6666)");

    // Invalid cache
    execf("_WDWORD(0xE0042004, 1)");
    execf("_WDWORD(0xE0042000, 0)");
    execf("_sleep_(4)");
}

pre_load();

LOAD %L;

FUNC void OnResetExec(void)
{
    // Set PC & SP to flash firmware entry, address better uncacheable
    execf("R0 = __Vectors;");
    execf("R1 = __Vectors + 4;");

    // Set PC & SP to flash firmware entry, address better uncacheable
    exec("SP = _RDWORD(R0);");
    exec("PC = _RDWORD(R1);");
}

OnResetExec()